#!/usr/bin/env bash
# Usage: ./process [start_frame] [thinning_factor]
# Defaults: start_frame=1 (all), thinning_factor=8

start_frame=${1:-1}
thinning_factor=${2:-8}
output_dir="processed_frames"
mkdir -p "$output_dir"

i=0
new_num=1
ls frame_*.txt | sort -V | tail -n +$start_frame | while read -r f; do
  if ((i % thinning_factor == 0)); then
    new_name="frame-${new_num}.txt"
    cp "$f" "$output_dir/$new_name"
    ((new_num++))
  fi
  ((i++))
done

echo "Processed: Kept $((($(ls frame_*.txt | wc -l) - start_frame + 1 + thinning_factor - 1) / thinning_factor)) frames in $output_dir"
echo -e "Play: cd $output_dir; for f in \$(ls frame-*.txt | sort -V); do cat \$f; sleep 0.15; clear; done"

font="JetBrainsMono NFM"
scale=20

echo -e "\nGenerating frame images using ansee"
if command -v ansee &>/dev/null; then
  for f in frame-*.txt; do
    ansee "$f" -o "${f%.txt}.png" -f "$font" -s $scale
  done
else
  echo "ansee command not found. install it from https://github.com/codersauce/ansee"
fi
